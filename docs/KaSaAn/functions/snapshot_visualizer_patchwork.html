<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.9.2" />
<title>KaSaAn.functions.snapshot_visualizer_patchwork API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>KaSaAn.functions.snapshot_visualizer_patchwork</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">#!/usr/bin/env python3

import colorsys
import matplotlib as mpl
import matplotlib.pyplot as plt
import matplotlib.patches
import matplotlib.text
import numpy
import squarify
import warnings
from matplotlib.collections import PatchCollection
from operator import itemgetter
from typing import List, Set, Dict, Tuple, Any

from ..core.KappaSnapshot import KappaSnapshot
from ..core.KappaAgent import KappaAgent


def process_snapshot(snapshot: KappaSnapshot) -&gt; List[dict]:
    &#34;&#34;&#34;Extract relevant information from a snapshot: size, abundance, &amp; compositions&#34;&#34;&#34;
    data = []
    for kappa_complex, abundance in snapshot.get_all_complexes_and_abundances():
        size = kappa_complex.get_size_of_complex()
        composition = kappa_complex.get_complex_composition()
        data.append({&#39;size&#39;: size, &#39;count&#39;: abundance, &#39;mass&#39;: size * abundance, &#39;composition&#39;: composition})
    if len(data) &lt; 1:
        warnings.warn(&#39;Empty snapshot &lt;&lt;&#39; + str(snapshot) + &#39;&gt;&gt;&#39;)
    return data


def colorize_agents(agent_set: Set[KappaAgent]) -&gt; Dict[KappaAgent, Any]:
    &#34;&#34;&#34;Generate &amp; associate colors as a dictionary {Agent: Color}&#34;&#34;&#34;
    agent_list = list(agent_set)
    num_agents = len(agent_list)
    agent_colors = {}
    # Use built-in palettes: for 10 or less use the default colors
    if num_agents &lt;= len(mpl.rcParams[&#39;axes.prop_cycle&#39;]):
        for agent in range(num_agents):
            agent_colors[agent_list[agent]] = &#39;C&#39; + str(agent)
    # For 20 or more agents, use the tab20 colormap
    elif num_agents &lt;= 20:
        colormap = plt.get_cmap(&#39;tab20&#39;)
        for agent in range(num_agents):
            agent_colors[agent_list[agent]] = colormap(agent)
    # For more than 20, pick linearly spaced values on HSV space
    else:
        h = numpy.linspace(start=0, stop=1, num=num_agents, endpoint=False)
        for agent in range(num_agents):
            agent_colors[agent_list[agent]] = colorsys.hsv_to_rgb(h[agent], 0.7, 0.75)
    return agent_colors


def _sanity_check_colors(snapshot: KappaSnapshot, color_scheme: Dict[KappaAgent, Any]):
    &#34;&#34;&#34;Sanity check a user-provided color-scheme.&#34;&#34;&#34;
    agent_list = snapshot.get_agent_types_present()
    if color_scheme.keys() != agent_list:
        for agent in color_scheme:
            if agent not in agent_list:
                warnings.warn(
                    &#39;Agent &lt;&#39; + agent.get_agent_name() +
                    &#39;&gt; provided in coloring scheme is not present in snapshot &lt;&#39; +
                    snapshot.get_snapshot_file_name() + &#39;&gt;.&#39;)
        for agent in agent_list:
            if agent not in color_scheme:
                warnings.warn(
                    &#39;Agent &lt;&#39; + agent.get_agent_name() +
                    &#39;&gt; present in snapshot &lt;&#39; + snapshot.get_snapshot_file_name() +
                    &#39;&gt; has no color assigned in the scheme provided.&#39;)


def snapshot_composition_simple(data: List[dict], color_scheme: Dict[KappaAgent, Any], vis_mode: str,
                                x_res: float, y_res: float) -&gt; Tuple[List[matplotlib.patches.Rectangle], int]:
    &#34;&#34;&#34;Assemble a list of rectangles for MatPlotLib to plot, plus the size of the largest of these (for mass
     normalization in trace movie making).&#34;&#34;&#34;
    if vis_mode != &#39;size&#39; and vis_mode != &#39;count&#39; and vis_mode != &#39;mass&#39;:
        warnings.warn(&#39;Unknown mode &lt;&lt;&#39; + vis_mode + &#39;&gt;&gt;&#39;)
    species_num = len(data)

    # First plot the species &amp; their agent composition
    # Sort the data according to visualization mode
    if vis_mode == &#39;mass&#39;:
        sorted_data = sorted(data, key=lambda k: k[&#39;mass&#39;], reverse=True)
        areas = [species[&#39;mass&#39;] for species in sorted_data]
    elif vis_mode == &#39;count&#39;:
        sorted_data = sorted(data, key=lambda k: k[&#39;count&#39;], reverse=True)
        areas = [species[&#39;count&#39;] for species in sorted_data]
    else:
        sorted_data = sorted(data, key=lambda k: k[&#39;size&#39;], reverse=True)
        areas = [species[&#39;size&#39;] for species in sorted_data]
    compositions = [species[&#39;composition&#39;] for species in sorted_data]
    # Save value of largest entity, useful for legend annotation
    max_value = max(areas)

    # Normalize the data by specified x/y resolution
    areas = squarify.normalize_sizes(sizes=areas, dy=y_res, dx=x_res)
    species_canvases = squarify.padded_squarify(sizes=areas, x=0, y=0, dy=y_res, dx=x_res)

    # Determine the rectangles that make up each species, i.e. composition
    agent_patches = []
    species_patches = []
    for species in range(species_num):
        # Define the box that represents this species as a whole
        species_canvas = species_canvases[species]
        s = matplotlib.patches.Rectangle(xy=(species_canvas[&#39;x&#39;], species_canvas[&#39;y&#39;]),
                                         width=species_canvas[&#39;dx&#39;],
                                         height=species_canvas[&#39;dy&#39;],
                                         facecolor=&#39;#00000000&#39;,
                                         edgecolor=&#39;#000000ff&#39;)
        species_patches.append(s)
        # Determine the agent composition of this species
        composition = compositions[species]
        agent_count = [composition[k] for k in sorted(composition, key=composition.get, reverse=True)]
        agent_type = [k for k in sorted(composition, key=composition.get, reverse=True)]
        # Calculate the sub-rectangles to draw on this rectangle / canvas
        normalized_agent_count = squarify.normalize_sizes(sizes=agent_count,
                                                          dx=species_canvas[&#39;dx&#39;],
                                                          dy=species_canvas[&#39;dy&#39;])
        agent_rectangles = squarify.squarify(sizes=normalized_agent_count,
                                             x=species_canvas[&#39;x&#39;],
                                             y=species_canvas[&#39;y&#39;],
                                             dy=species_canvas[&#39;dy&#39;],
                                             dx=species_canvas[&#39;dx&#39;])
        # Draw the rectangles using the appropriate color (determined by the agent type)
        for a in range(len(agent_type)):
            agent_rectangle = agent_rectangles[a]
            r = matplotlib.patches.Rectangle(xy=(agent_rectangle[&#39;x&#39;], agent_rectangle[&#39;y&#39;]),
                                             width=agent_rectangle[&#39;dx&#39;],
                                             height=agent_rectangle[&#39;dy&#39;],
                                             facecolor=color_scheme[agent_type[a]])
            agent_patches.append(r)

    # Add the rectangles to the figure
    patch_list = agent_patches + species_patches

    return patch_list, max_value


def snapshot_legend_simple(color_scheme: Dict[KappaAgent, Any], col_num: int) -&gt;\
        Tuple[List[mpl.patches.Rectangle], List[matplotlib.text.Text]]:
    &#34;&#34;&#34;Create legend components; their entries with appropriate colors (as composition key);
     companion to snapshot_composition_simple.&#34;&#34;&#34;
    position = 0    # var to track indexing
    x_dim = 0.5     # size of rectangle serving as color key
    y_dim = 0.5
    rect_list = []
    text_list = []
    for agent, color in sorted(color_scheme.items(), key=itemgetter(0), reverse=False):
        y_pos, x_pos = divmod(position, col_num)
        legend_entry_rect = matplotlib.patches.Rectangle(
            xy=(x_pos, -y_pos), width=x_dim, height=y_dim, edgecolor=&#39;#000000&#39;, fc=color)
        legend_entry_text = matplotlib.text.Text(
            x=x_pos + x_dim, y=-y_pos, text=agent.get_agent_name(), verticalalignment=&#39;baseline&#39;)
        rect_list.append(legend_entry_rect)
        text_list.append(legend_entry_text)
        position += 1
    return rect_list, text_list


def _snapshot_legend_maxima(vis_mode: str, max_mass: int, max_size: int, max_count: int) -&gt; List[matplotlib.text.Text]:
    &#34;&#34;&#34;Define the maxima to put on the legend based on visualization mode.&#34;&#34;&#34;
    if vis_mode == &#39;all&#39;:
        # Add entries for maxima at the top
        max_mass_text = matplotlib.text.Text(x=0, y=4, text=&#39;Max mass: &#39; + str(max_mass), verticalalignment=&#39;top&#39;)
        max_size_text = matplotlib.text.Text(x=0, y=3, text=&#39;Max size: &#39; + str(max_size), verticalalignment=&#39;top&#39;)
        max_count_text = matplotlib.text.Text(x=0, y=2, text=&#39;Max count: &#39; + str(max_count), verticalalignment=&#39;top&#39;)
        text_list = [max_mass_text, max_size_text, max_count_text]
    else:
        text_list = matplotlib.text.Text(x=0, y=2, text=&#39;Max &#39; + vis_mode + &#39;: &#39; + str(max_mass),
                                         verticalalignment=&#39;top&#39;)
    return text_list


def _snapshot_legend_maximum(max_data: int, vis_mode: str) -&gt; matplotlib.text.Text:
    &#34;&#34;&#34;Same as snapshot_legend_maxima, but for a single maximum.&#34;&#34;&#34;
    max_text = matplotlib.text.Text(x=0, y=2, text=&#39;Max &#39; + vis_mode + &#39;: &#39; + str(max_data), verticalalignment=&#39;top&#39;)
    return max_text


def render_snapshot_as_patchwork(snapshot_file: str, color_scheme: Dict[KappaAgent, Any] = None, vis_mode: str = &#39;all&#39;,
                                 fig_size: Tuple[float, float] = mpl.rcParams[&#39;figure.figsize&#39;],
                                 fig_res: float = mpl.rcParams[&#39;figure.dpi&#39;]) -&gt; plt.figure:
    &#34;&#34;&#34;Render a snapshot as a patchwork / tree-map diagram, using any of four supported modes:

    * `count`: a complex&#39; area is proportional to how many times it appears
    * `size`: a complex&#39; area is proportional to how big it is
    * `mass`: a complex&#39; area is proportional to how much mass it has, the product of its count times its mass
    * `all`: plot all three side by side

    See file under `KaSaAn.scripts` for further usage.&#34;&#34;&#34;
    # Process the snapshot
    my_snapshot = KappaSnapshot(snapshot_file)
    my_data = process_snapshot(my_snapshot)
    if len(my_data) &lt; 1:
        warnings.warn(&#39;Empty snapshot &lt;&lt;&#39; + snapshot_file + &#39;&gt;&gt;&#39;)
    # sanity check color scheme, or create one
    if color_scheme:
        _sanity_check_colors(snapshot=my_snapshot, color_scheme=color_scheme)
        my_color_scheme = color_scheme
    else:
        agent_list = my_snapshot.get_agent_types_present()
        if len(agent_list) &gt; 20:
            print(&#39;Over 20 agents found: palette might be ugly. &#39;
                  &#39;Try googling &lt;&lt;iwanthue&gt;&gt; for a tool to generate distinct colors.&#39;)
        my_color_scheme = colorize_agents(agent_list)

    # Define figure definition &amp; resolution
    res_w = fig_res * fig_size[0]
    res_h = fig_res * fig_size[1]
    figure = plt.figure(figsize=fig_size)

    # If visualizing all, then we need three subplots (for mass, size, count), plus the area for the legend
    if vis_mode == &#39;all&#39;:
        # Define all three axes
        ax_mass = figure.add_subplot(221, aspect=1)
        ax_size = figure.add_subplot(222, aspect=1)
        ax_count = figure.add_subplot(223, aspect=1)
        ax_legend = figure.add_subplot(224)
        # Draw data onto axes
        rectangles_mass, my_max_mass = snapshot_composition_simple(
            data=my_data, color_scheme=my_color_scheme, vis_mode=&#39;mass&#39;, x_res=res_w, y_res=res_h)
        rectangles_size, my_max_size = snapshot_composition_simple(
            data=my_data, color_scheme=my_color_scheme, vis_mode=&#39;size&#39;, x_res=res_w, y_res=res_h)
        rectangles_count, my_max_count = snapshot_composition_simple(
            data=my_data, color_scheme=my_color_scheme, vis_mode=&#39;count&#39;, x_res=res_w, y_res=res_h)
        ax_mass.add_collection(PatchCollection(rectangles_mass, match_original=True))
        ax_size.add_collection(PatchCollection(rectangles_size, match_original=True))
        ax_count.add_collection(PatchCollection(rectangles_count, match_original=True))

        # Add title onto axes, hide the ticks, re-center the bounding box
        ax_mass.set_title(&#39;Mass&#39;)
        ax_size.set_title(&#39;Size&#39;)
        ax_count.set_title(&#39;Count&#39;)
        ax_mass.axis(&#39;off&#39;)
        ax_size.axis(&#39;off&#39;)
        ax_count.axis(&#39;off&#39;)
        ax_mass.axis(&#39;tight&#39;)
        ax_size.axis(&#39;tight&#39;)
        ax_count.axis(&#39;tight&#39;)

        # Define maxima; proxy for scale bar
        maxima_texts = _snapshot_legend_maxima(
            vis_mode=vis_mode, max_mass=my_max_mass, max_count=my_max_count, max_size=my_max_size)
        legend_top_edge = 4
        for text in maxima_texts:
            ax_legend.add_artist(text)

    else:
        ax_data = figure.add_subplot(121, aspect=1)
        ax_legend = figure.add_subplot(122, aspect=1)
        plt.title(label=&#39;Area proportional to &#39; + vis_mode + &#39; of species&#39;)
        rectangles_data, my_max_data = snapshot_composition_simple(
            data=my_data, color_scheme=my_color_scheme, vis_mode=vis_mode, x_res=res_w, y_res=res_h)
        ax_data.add_collection(PatchCollection(rectangles_data, match_original=True))
        ax_data.axis(&#39;off&#39;)
        ax_data.axis(&#39;tight&#39;)

        # Define maximum; proxy for scale bar
        maxima_text = _snapshot_legend_maximum(vis_mode=vis_mode, max_data=my_max_data)
        legend_top_edge = 2
        ax_legend.add_artist(maxima_text)

    # Add the legend
    columns = 5     # number of columns in legend
    legend_squares, legend_texts = snapshot_legend_simple(color_scheme=my_color_scheme, col_num=columns)
    ax_legend.add_collection(PatchCollection(legend_squares, match_original=True))
    for text in legend_texts:
        ax_legend.add_artist(text)

    ax_legend.set_xlim(left=0, right=columns)
    ax_legend.set_ylim(top=legend_top_edge, bottom=-divmod(len(my_color_scheme), columns)[0] - 1)
    ax_legend.axis(&#39;off&#39;)
    return figure</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="KaSaAn.functions.snapshot_visualizer_patchwork.colorize_agents"><code class="name flex">
<span>def <span class="ident">colorize_agents</span></span>(<span>agent_set: Set[KaSaAn.core.KappaAgent.KappaAgent]) ‑> Dict[KaSaAn.core.KappaAgent.KappaAgent, Any]</span>
</code></dt>
<dd>
<div class="desc"><p>Generate &amp; associate colors as a dictionary {Agent: Color}</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def colorize_agents(agent_set: Set[KappaAgent]) -&gt; Dict[KappaAgent, Any]:
    &#34;&#34;&#34;Generate &amp; associate colors as a dictionary {Agent: Color}&#34;&#34;&#34;
    agent_list = list(agent_set)
    num_agents = len(agent_list)
    agent_colors = {}
    # Use built-in palettes: for 10 or less use the default colors
    if num_agents &lt;= len(mpl.rcParams[&#39;axes.prop_cycle&#39;]):
        for agent in range(num_agents):
            agent_colors[agent_list[agent]] = &#39;C&#39; + str(agent)
    # For 20 or more agents, use the tab20 colormap
    elif num_agents &lt;= 20:
        colormap = plt.get_cmap(&#39;tab20&#39;)
        for agent in range(num_agents):
            agent_colors[agent_list[agent]] = colormap(agent)
    # For more than 20, pick linearly spaced values on HSV space
    else:
        h = numpy.linspace(start=0, stop=1, num=num_agents, endpoint=False)
        for agent in range(num_agents):
            agent_colors[agent_list[agent]] = colorsys.hsv_to_rgb(h[agent], 0.7, 0.75)
    return agent_colors</code></pre>
</details>
</dd>
<dt id="KaSaAn.functions.snapshot_visualizer_patchwork.process_snapshot"><code class="name flex">
<span>def <span class="ident">process_snapshot</span></span>(<span>snapshot: KaSaAn.core.KappaSnapshot.KappaSnapshot) ‑> List[dict]</span>
</code></dt>
<dd>
<div class="desc"><p>Extract relevant information from a snapshot: size, abundance, &amp; compositions</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def process_snapshot(snapshot: KappaSnapshot) -&gt; List[dict]:
    &#34;&#34;&#34;Extract relevant information from a snapshot: size, abundance, &amp; compositions&#34;&#34;&#34;
    data = []
    for kappa_complex, abundance in snapshot.get_all_complexes_and_abundances():
        size = kappa_complex.get_size_of_complex()
        composition = kappa_complex.get_complex_composition()
        data.append({&#39;size&#39;: size, &#39;count&#39;: abundance, &#39;mass&#39;: size * abundance, &#39;composition&#39;: composition})
    if len(data) &lt; 1:
        warnings.warn(&#39;Empty snapshot &lt;&lt;&#39; + str(snapshot) + &#39;&gt;&gt;&#39;)
    return data</code></pre>
</details>
</dd>
<dt id="KaSaAn.functions.snapshot_visualizer_patchwork.render_snapshot_as_patchwork"><code class="name flex">
<span>def <span class="ident">render_snapshot_as_patchwork</span></span>(<span>snapshot_file: str, color_scheme: Dict[KaSaAn.core.KappaAgent.KappaAgent, Any] = None, vis_mode: str = 'all', fig_size: Tuple[float, float] = [6.4, 4.8], fig_res: float = 100.0) ‑> <function figure at 0x7f78854d8a60></span>
</code></dt>
<dd>
<div class="desc"><p>Render a snapshot as a patchwork / tree-map diagram, using any of four supported modes:</p>
<ul>
<li><code>count</code>: a complex' area is proportional to how many times it appears</li>
<li><code>size</code>: a complex' area is proportional to how big it is</li>
<li><code>mass</code>: a complex' area is proportional to how much mass it has, the product of its count times its mass</li>
<li><code>all</code>: plot all three side by side</li>
</ul>
<p>See file under <code><a title="KaSaAn.scripts" href="../scripts/index.html">KaSaAn.scripts</a></code> for further usage.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def render_snapshot_as_patchwork(snapshot_file: str, color_scheme: Dict[KappaAgent, Any] = None, vis_mode: str = &#39;all&#39;,
                                 fig_size: Tuple[float, float] = mpl.rcParams[&#39;figure.figsize&#39;],
                                 fig_res: float = mpl.rcParams[&#39;figure.dpi&#39;]) -&gt; plt.figure:
    &#34;&#34;&#34;Render a snapshot as a patchwork / tree-map diagram, using any of four supported modes:

    * `count`: a complex&#39; area is proportional to how many times it appears
    * `size`: a complex&#39; area is proportional to how big it is
    * `mass`: a complex&#39; area is proportional to how much mass it has, the product of its count times its mass
    * `all`: plot all three side by side

    See file under `KaSaAn.scripts` for further usage.&#34;&#34;&#34;
    # Process the snapshot
    my_snapshot = KappaSnapshot(snapshot_file)
    my_data = process_snapshot(my_snapshot)
    if len(my_data) &lt; 1:
        warnings.warn(&#39;Empty snapshot &lt;&lt;&#39; + snapshot_file + &#39;&gt;&gt;&#39;)
    # sanity check color scheme, or create one
    if color_scheme:
        _sanity_check_colors(snapshot=my_snapshot, color_scheme=color_scheme)
        my_color_scheme = color_scheme
    else:
        agent_list = my_snapshot.get_agent_types_present()
        if len(agent_list) &gt; 20:
            print(&#39;Over 20 agents found: palette might be ugly. &#39;
                  &#39;Try googling &lt;&lt;iwanthue&gt;&gt; for a tool to generate distinct colors.&#39;)
        my_color_scheme = colorize_agents(agent_list)

    # Define figure definition &amp; resolution
    res_w = fig_res * fig_size[0]
    res_h = fig_res * fig_size[1]
    figure = plt.figure(figsize=fig_size)

    # If visualizing all, then we need three subplots (for mass, size, count), plus the area for the legend
    if vis_mode == &#39;all&#39;:
        # Define all three axes
        ax_mass = figure.add_subplot(221, aspect=1)
        ax_size = figure.add_subplot(222, aspect=1)
        ax_count = figure.add_subplot(223, aspect=1)
        ax_legend = figure.add_subplot(224)
        # Draw data onto axes
        rectangles_mass, my_max_mass = snapshot_composition_simple(
            data=my_data, color_scheme=my_color_scheme, vis_mode=&#39;mass&#39;, x_res=res_w, y_res=res_h)
        rectangles_size, my_max_size = snapshot_composition_simple(
            data=my_data, color_scheme=my_color_scheme, vis_mode=&#39;size&#39;, x_res=res_w, y_res=res_h)
        rectangles_count, my_max_count = snapshot_composition_simple(
            data=my_data, color_scheme=my_color_scheme, vis_mode=&#39;count&#39;, x_res=res_w, y_res=res_h)
        ax_mass.add_collection(PatchCollection(rectangles_mass, match_original=True))
        ax_size.add_collection(PatchCollection(rectangles_size, match_original=True))
        ax_count.add_collection(PatchCollection(rectangles_count, match_original=True))

        # Add title onto axes, hide the ticks, re-center the bounding box
        ax_mass.set_title(&#39;Mass&#39;)
        ax_size.set_title(&#39;Size&#39;)
        ax_count.set_title(&#39;Count&#39;)
        ax_mass.axis(&#39;off&#39;)
        ax_size.axis(&#39;off&#39;)
        ax_count.axis(&#39;off&#39;)
        ax_mass.axis(&#39;tight&#39;)
        ax_size.axis(&#39;tight&#39;)
        ax_count.axis(&#39;tight&#39;)

        # Define maxima; proxy for scale bar
        maxima_texts = _snapshot_legend_maxima(
            vis_mode=vis_mode, max_mass=my_max_mass, max_count=my_max_count, max_size=my_max_size)
        legend_top_edge = 4
        for text in maxima_texts:
            ax_legend.add_artist(text)

    else:
        ax_data = figure.add_subplot(121, aspect=1)
        ax_legend = figure.add_subplot(122, aspect=1)
        plt.title(label=&#39;Area proportional to &#39; + vis_mode + &#39; of species&#39;)
        rectangles_data, my_max_data = snapshot_composition_simple(
            data=my_data, color_scheme=my_color_scheme, vis_mode=vis_mode, x_res=res_w, y_res=res_h)
        ax_data.add_collection(PatchCollection(rectangles_data, match_original=True))
        ax_data.axis(&#39;off&#39;)
        ax_data.axis(&#39;tight&#39;)

        # Define maximum; proxy for scale bar
        maxima_text = _snapshot_legend_maximum(vis_mode=vis_mode, max_data=my_max_data)
        legend_top_edge = 2
        ax_legend.add_artist(maxima_text)

    # Add the legend
    columns = 5     # number of columns in legend
    legend_squares, legend_texts = snapshot_legend_simple(color_scheme=my_color_scheme, col_num=columns)
    ax_legend.add_collection(PatchCollection(legend_squares, match_original=True))
    for text in legend_texts:
        ax_legend.add_artist(text)

    ax_legend.set_xlim(left=0, right=columns)
    ax_legend.set_ylim(top=legend_top_edge, bottom=-divmod(len(my_color_scheme), columns)[0] - 1)
    ax_legend.axis(&#39;off&#39;)
    return figure</code></pre>
</details>
</dd>
<dt id="KaSaAn.functions.snapshot_visualizer_patchwork.snapshot_composition_simple"><code class="name flex">
<span>def <span class="ident">snapshot_composition_simple</span></span>(<span>data: List[dict], color_scheme: Dict[KaSaAn.core.KappaAgent.KappaAgent, Any], vis_mode: str, x_res: float, y_res: float) ‑> Tuple[List[matplotlib.patches.Rectangle], int]</span>
</code></dt>
<dd>
<div class="desc"><p>Assemble a list of rectangles for MatPlotLib to plot, plus the size of the largest of these (for mass
normalization in trace movie making).</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def snapshot_composition_simple(data: List[dict], color_scheme: Dict[KappaAgent, Any], vis_mode: str,
                                x_res: float, y_res: float) -&gt; Tuple[List[matplotlib.patches.Rectangle], int]:
    &#34;&#34;&#34;Assemble a list of rectangles for MatPlotLib to plot, plus the size of the largest of these (for mass
     normalization in trace movie making).&#34;&#34;&#34;
    if vis_mode != &#39;size&#39; and vis_mode != &#39;count&#39; and vis_mode != &#39;mass&#39;:
        warnings.warn(&#39;Unknown mode &lt;&lt;&#39; + vis_mode + &#39;&gt;&gt;&#39;)
    species_num = len(data)

    # First plot the species &amp; their agent composition
    # Sort the data according to visualization mode
    if vis_mode == &#39;mass&#39;:
        sorted_data = sorted(data, key=lambda k: k[&#39;mass&#39;], reverse=True)
        areas = [species[&#39;mass&#39;] for species in sorted_data]
    elif vis_mode == &#39;count&#39;:
        sorted_data = sorted(data, key=lambda k: k[&#39;count&#39;], reverse=True)
        areas = [species[&#39;count&#39;] for species in sorted_data]
    else:
        sorted_data = sorted(data, key=lambda k: k[&#39;size&#39;], reverse=True)
        areas = [species[&#39;size&#39;] for species in sorted_data]
    compositions = [species[&#39;composition&#39;] for species in sorted_data]
    # Save value of largest entity, useful for legend annotation
    max_value = max(areas)

    # Normalize the data by specified x/y resolution
    areas = squarify.normalize_sizes(sizes=areas, dy=y_res, dx=x_res)
    species_canvases = squarify.padded_squarify(sizes=areas, x=0, y=0, dy=y_res, dx=x_res)

    # Determine the rectangles that make up each species, i.e. composition
    agent_patches = []
    species_patches = []
    for species in range(species_num):
        # Define the box that represents this species as a whole
        species_canvas = species_canvases[species]
        s = matplotlib.patches.Rectangle(xy=(species_canvas[&#39;x&#39;], species_canvas[&#39;y&#39;]),
                                         width=species_canvas[&#39;dx&#39;],
                                         height=species_canvas[&#39;dy&#39;],
                                         facecolor=&#39;#00000000&#39;,
                                         edgecolor=&#39;#000000ff&#39;)
        species_patches.append(s)
        # Determine the agent composition of this species
        composition = compositions[species]
        agent_count = [composition[k] for k in sorted(composition, key=composition.get, reverse=True)]
        agent_type = [k for k in sorted(composition, key=composition.get, reverse=True)]
        # Calculate the sub-rectangles to draw on this rectangle / canvas
        normalized_agent_count = squarify.normalize_sizes(sizes=agent_count,
                                                          dx=species_canvas[&#39;dx&#39;],
                                                          dy=species_canvas[&#39;dy&#39;])
        agent_rectangles = squarify.squarify(sizes=normalized_agent_count,
                                             x=species_canvas[&#39;x&#39;],
                                             y=species_canvas[&#39;y&#39;],
                                             dy=species_canvas[&#39;dy&#39;],
                                             dx=species_canvas[&#39;dx&#39;])
        # Draw the rectangles using the appropriate color (determined by the agent type)
        for a in range(len(agent_type)):
            agent_rectangle = agent_rectangles[a]
            r = matplotlib.patches.Rectangle(xy=(agent_rectangle[&#39;x&#39;], agent_rectangle[&#39;y&#39;]),
                                             width=agent_rectangle[&#39;dx&#39;],
                                             height=agent_rectangle[&#39;dy&#39;],
                                             facecolor=color_scheme[agent_type[a]])
            agent_patches.append(r)

    # Add the rectangles to the figure
    patch_list = agent_patches + species_patches

    return patch_list, max_value</code></pre>
</details>
</dd>
<dt id="KaSaAn.functions.snapshot_visualizer_patchwork.snapshot_legend_simple"><code class="name flex">
<span>def <span class="ident">snapshot_legend_simple</span></span>(<span>color_scheme: Dict[KaSaAn.core.KappaAgent.KappaAgent, Any], col_num: int) ‑> Tuple[List[matplotlib.patches.Rectangle], List[matplotlib.text.Text]]</span>
</code></dt>
<dd>
<div class="desc"><p>Create legend components; their entries with appropriate colors (as composition key);
companion to snapshot_composition_simple.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def snapshot_legend_simple(color_scheme: Dict[KappaAgent, Any], col_num: int) -&gt;\
        Tuple[List[mpl.patches.Rectangle], List[matplotlib.text.Text]]:
    &#34;&#34;&#34;Create legend components; their entries with appropriate colors (as composition key);
     companion to snapshot_composition_simple.&#34;&#34;&#34;
    position = 0    # var to track indexing
    x_dim = 0.5     # size of rectangle serving as color key
    y_dim = 0.5
    rect_list = []
    text_list = []
    for agent, color in sorted(color_scheme.items(), key=itemgetter(0), reverse=False):
        y_pos, x_pos = divmod(position, col_num)
        legend_entry_rect = matplotlib.patches.Rectangle(
            xy=(x_pos, -y_pos), width=x_dim, height=y_dim, edgecolor=&#39;#000000&#39;, fc=color)
        legend_entry_text = matplotlib.text.Text(
            x=x_pos + x_dim, y=-y_pos, text=agent.get_agent_name(), verticalalignment=&#39;baseline&#39;)
        rect_list.append(legend_entry_rect)
        text_list.append(legend_entry_text)
        position += 1
    return rect_list, text_list</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="KaSaAn.functions" href="index.html">KaSaAn.functions</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="KaSaAn.functions.snapshot_visualizer_patchwork.colorize_agents" href="#KaSaAn.functions.snapshot_visualizer_patchwork.colorize_agents">colorize_agents</a></code></li>
<li><code><a title="KaSaAn.functions.snapshot_visualizer_patchwork.process_snapshot" href="#KaSaAn.functions.snapshot_visualizer_patchwork.process_snapshot">process_snapshot</a></code></li>
<li><code><a title="KaSaAn.functions.snapshot_visualizer_patchwork.render_snapshot_as_patchwork" href="#KaSaAn.functions.snapshot_visualizer_patchwork.render_snapshot_as_patchwork">render_snapshot_as_patchwork</a></code></li>
<li><code><a title="KaSaAn.functions.snapshot_visualizer_patchwork.snapshot_composition_simple" href="#KaSaAn.functions.snapshot_visualizer_patchwork.snapshot_composition_simple">snapshot_composition_simple</a></code></li>
<li><code><a title="KaSaAn.functions.snapshot_visualizer_patchwork.snapshot_legend_simple" href="#KaSaAn.functions.snapshot_visualizer_patchwork.snapshot_legend_simple">snapshot_legend_simple</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.9.2</a>.</p>
</footer>
</body>
</html>